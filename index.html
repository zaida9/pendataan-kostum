<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Dashboard Kostum</title>

  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore-compat.js"></script>

  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f4f6f9;
      margin: 0;
      padding: 20px;
    }

    h1 { text-align: center; }

    .container {
      max-width: 1000px;
      margin: auto;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      background: white;
      margin-top: 20px;
    }

    th, td {
      padding: 10px;
      border: 1px solid #ddd;
      text-align: center;
    }

    th {
      background: #007bff;
      color: white;
    }

    button {
      padding: 8px 12px;
      border: none;
      background: #007bff;
      color: white;
      cursor: pointer;
      border-radius: 6px;
    }

    #mainApp { display: none; }

    .login-box {
      max-width: 300px;
      margin: 100px auto;
      background: white;
      padding: 20px;
      border-radius: 10px;
      text-align: center;
    }

    input {
      width: 100%;
      padding: 8px;
      margin: 8px 0;
    }

    .chart-box {
      background: white;
      margin-top: 20px;
      padding: 20px;
      border-radius: 12px;
    }

    .error { color: red; }
  </style>
</head>
<body>

<!-- ðŸ” LOGIN -->
<div id="loginPage" class="login-box">
  <h2>Login Admin</h2>
  <form onsubmit="login(event)">
    <input id="loginUser" placeholder="Username" required>
    <input id="loginPass" type="password" placeholder="Password" required>
    <button type="submit">Login</button>
    <p id="loginError" class="error"></p>
  </form>
</div>

<!-- ðŸ“Š MAIN APP -->
<div id="mainApp" class="container">
  <h1>Dashboard Kostum</h1>

  <button onclick="tambahContoh()">Tambah Data Contoh</button>

  <table>
    <thead>
      <tr>
        <th>Nama Kostum</th>
        <th>Jenis</th>
        <th>Stok</th>
      </tr>
    </thead>
    <tbody id="tabelKostum"></tbody>
  </table>

  <div class="chart-box">
    <canvas id="chartJenis"></canvas>
  </div>
</div>

<script>
/* ================= LOGIN ================= */
const USERNAME = "admin";
const PASSWORD = "123";

const loginPage = document.getElementById("loginPage");
const mainApp   = document.getElementById("mainApp");
const loginUser = document.getElementById("loginUser");
const loginPass = document.getElementById("loginPass");
const loginError= document.getElementById("loginError");

function login(e){
  e.preventDefault();

  if(loginUser.value === USERNAME && loginPass.value === PASSWORD){
    localStorage.setItem("login","yes");
    loginPage.style.display = "none";
    mainApp.style.display = "block";
  }else{
    loginError.innerText = "Username atau password salah";
  }
}

if(localStorage.getItem("login")==="yes"){
  loginPage.style.display="none";
  mainApp.style.display="block";
}

/* ================= FIREBASE ================= */
const firebaseConfig = {
  apiKey: "AIzaSyAZUybNqjxxb-KXMZ4ICL03GcO-StBzU-Y",
  authDomain: "pendataan-kostum.firebaseapp.com",
  projectId: "pendataan-kostum",
  storageBucket: "pendataan-kostum.firebasestorage.app",
  messagingSenderId: "226459234974",
  appId: "1:226459234974:web:2b0512247ff01c738a418f",
  measurementId: "G-4QQT28BDV0"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

/* ================= DATA ================= */
let kostum = [];
const tabel = document.getElementById("tabelKostum");
let chart;

/* ================= RENDER TABLE ================= */
function render(){
  tabel.innerHTML = "";

  kostum.forEach((k)=>{
    tabel.innerHTML += `
      <tr>
        <td>${k.nama}</td>
        <td>${k.jenis}</td>
        <td>${k.stok}</td>
      </tr>
    `;
  });

  renderChart();
}

/* ================= CHART ================= */
function renderChart(){
  const jenisMap = {};

  kostum.forEach((k)=>{
    jenisMap[k.jenis] = (jenisMap[k.jenis] || 0) + k.stok;
  });

  const labels = Object.keys(jenisMap);
  const data   = Object.values(jenisMap);

  if(chart) chart.destroy();

  chart = new Chart(document.getElementById("chartJenis"), {
    type: "bar",
    data: {
      labels,
      datasets: [{ label: "Stok per Jenis", data }]
    }
  });
}

/* ================= TAMBAH DATA ================= */
function tambahContoh(){
  const dataBaru = {
    nama: "Kostum Baru " + Math.floor(Math.random()*100),
    jenis: ["Adat","Profesi","Hewan"][Math.floor(Math.random()*3)],
    stok: Math.floor(Math.random()*10)+1,
  };

  db.collection("kostum").add(dataBaru);
}

/* ================= REALTIME ================= */
db.collection("kostum").onSnapshot((snapshot)=>{
  kostum = [];
  snapshot.forEach((doc)=> kostum.push(doc.data()));
  render();
});
</script>
</body>
</html>
